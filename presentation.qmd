---
title: "Game Metrics: Decoding Premier League Outcomes Through Visual Analysis and Data Exploration"
subtitle: "INFO 526 - Fall 2023 - Project 1"
author: "Akash Srinivasan, Gillian McGinnis, Jiayue He, Sai Navya Reddy, Sanja Dmitrovic, Valerie Okine"
title-slide-attributes:
  data-background-image: images/watercolour_sys02_img34_teacup-ocean.jpg
  data-background-size: stretch
  data-background-opacity: "0.7"
  data-slide-number: none
format:
  revealjs:
    theme:  ['data/customtheming.scss']
  
editor: visual
execute:
  echo: false
---

```{r}
#| label: load-pkgs
#| message: false
#| output: false
#| echo: false
if(!require(pacman))
  install.packages("pacman")

pacman::p_load(
  tidyverse,
  here,
  ggthemes,
  viridis,
  ggcorrplot,
  devtools,
  ragg,
  colorspace,
  sysfonts,
  showtext,
  scales
  )

options(width = 65)

knitr::opts_chunk$set(
  fig.asp = 0.618,
  fig.align = "center",
  fig.retina = 1,
  fig.showtext = T
)
```

```{r}
#| label: setup
#| include: false

# Plot theme
ggplot2::theme_set(ggplot2::theme_minimal(base_size = 11))

# For better figure resolution
knitr::opts_chunk$set(
  fig.retina = 3, 
  dpi = 300, 
  fig.width = 6, 
  fig.asp = 0.618 
  )
```
```{r}
#| label: setup
#| include: false

# Plot theme
ggplot2::theme_set(ggplot2::theme_minimal(base_size = 11))
```
```{r}
#| label: load-dataset-colors
#| message: false
#| echo: false
soccer <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2023/2023-04-04/soccer21-22.csv')

pal_pl <- c("#F8145C", "#45F2FD", "#30FF86", "#E9FF00")
pal_pl_logo <- "#3d195b"

lab_pl_subtitle <- "Premier League match data, 2021-2022 season"

sysfonts::font_add_google("Poppins")
showtext::showtext_auto()
```

INTRODUCTION
::: incremental
This Dataset derived from TidyTuesday's April 4, 2023 post "Premier League Match Data 2021-2022".
The data is sourced from Evan Gower's Kaggle post of the same name.
Variables included are teams, referees, and match statistics for home and away sides such as fouls, shots, cards, and point totals.
Tabular format with rows representing individual matches and columns representing variables.
The dataset contains both categorical and numerical variables.
It provides insights into team performance, referee assignments, and match statistics for the season.
:::

QUESTION1

1A. Do the number of goals at half-time determine the final outcome? Does this relationship change between home and away teams?

1B. Does home-team advantage play a major role in the final match outcome?

APPROACH
::: nonincremental
Part A

In Part A, we examine the correlation between half-time and full-time goals scored by home and away teams in the English Premier League 2021-2022 season. Using variables like HTHG, FTHG, HTAG, and FTAG, we create scatterplots, color-coded by team type. Separate linear regressions are conducted for home and away teams to determine correlation coefficients. This approach directly assesses the relationship strength between these variables, offering insights into match dynamics.

Part B

In Part B, we categorize home and away advantages in the English Premier League 2021-2022 season based on the Full Time Result (FTR) variable. A bar plot summarizes total games and goals scored by each team at home and away. We then create a new variable, Total goals, by combining advantage summaries with total goals. Finally, side-by-side bar plots interpret outcomes for all 20 teams using the Home team and Total variable.
::: nonincremental
Question 1A: Correlation between half-time and full-time goals.

```{r}
#| label: q1_goals
#| message: false
#| warning: false

#Create tibbles based on if the home or away team scored the goals. This makes it easier to color-code the scatterplot and calculate separate linear regressions later.
home_goals <- tibble(soccer$HTHG, soccer$FTHG)
home_goals <- home_goals %>% 
  rename(
     'half' = 'soccer$HTHG',
     'full' = 'soccer$FTHG'
  )

away_goals <- tibble(soccer$HTAG, soccer$FTAG)
away_goals <- away_goals %>% 
  rename(
    'half' = 'soccer$HTAG',
    'full' = 'soccer$FTAG'
  )

#Calculate correlation coefficients for home and away data sets.
home_r <- cor(home_goals$half, home_goals$full)
away_r <- cor(away_goals$half, away_goals$full)

#Create scatterplot with two regression lines for home and away teams, respectively. Add number of points and correlation coefficients to plot.
q1_goals <- ggplot() + 
  geom_jitter(data = home_goals, aes(x = half, y = full, color = 'Home'), width = 0.7) +
  geom_smooth(data = home_goals, aes(x = half, y = full, color = 'Home'), method = lm, se = FALSE) +
  geom_jitter(data = away_goals, aes(x = half, y = full, color = 'Away'), width = 0.7) +
  geom_smooth(data = away_goals, aes(x = half, y = full, color = 'Away'), method = lm,  se = FALSE) + 
  xlim(0, 4) +
  geom_label(aes(x = 0.25, y = 7, label= 'N = 380')) +
  geom_label(aes(x = 3.7, y = 5.5, label= 'r = 0.72', color = 'Home'), show.legend  = FALSE) +
  geom_label(aes(x = 3.7, y = 4.2, label= 'r = 0.70', color = 'Away'), show.legend = FALSE) +
  labs( x = 'Goals at half-time',
        y = 'Goals at full-time',
        color = 'Team') +
  scale_color_manual(
    breaks = c("Home", "Away"),
    values = darken(pal_pl, 0.3)
  ) + 
  theme_classic(base_size = 12) +
  theme(
    text = element_text("Poppins",
                        face = "bold",
                        color = pal_pl_logo))

#Suppress warning messages when printing ggplot object.
suppressMessages(print(q1_goals))

```
